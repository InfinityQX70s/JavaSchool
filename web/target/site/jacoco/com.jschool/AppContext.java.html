<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AppContext.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">web Maven Webapp</a> &gt; <a href="index.source.html" class="el_package">com.jschool</a> &gt; <span class="el_source">AppContext.java</span></div><h1>AppContext.java</h1><pre class="source lang-java linenums">package com.jschool;

import com.jschool.controllers.*;
import com.jschool.controllers.exception.ControllerStatusCode;
import com.jschool.dao.api.*;
import com.jschool.dao.impl.*;
import com.jschool.services.api.*;
import com.jschool.services.impl.*;


import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URI;
import java.net.URL;
import java.util.Properties;

/**
 * Created by infinity on 14.02.16.
 */
public class AppContext {

    private static AppContext instance;

    private static final String PERSISTENCE = &quot;Logiweb&quot;;

    private EntityManagerFactory entityManagerFactory;
    private EntityManager entityManager;

    private TransactionManager transactionManager;

    private CargoDao cargoDao;
    private CargoStatusLogDao cargoStatusLogDao;
    private CityDao cityDao;
    private DriverDao driverDao;
    private DriverStatisticDao driverStatisticDao;
    private DriverStatusLogDao driverStatusLogDao;
    private OrdersDao ordersDao;
    private RoutePointDao routePointDao;
    private TruckDao truckDao;
    private UserDao userDao;

    private UserService userService;
    private DriverService driverService;
    private DutyService dutyService;
    private OrderAndCargoService orderAndCargoService;
    private OrderManagementService orderManagementService;
    private TruckService truckService;

    private DriverController driverController;
    private OrderController orderController;
    private TruckController truckController;
    private LoginController loginController;
    private DriverInfoController driverInfoController;
    private ErrorController errorController;
    private Properties errorProperties;

    private ControllerFactory controllerFactory;

    private Validator validator;

<span class="nc" id="L65">    private AppContext() {</span>
<span class="nc" id="L66">    }</span>

    public static synchronized AppContext getInstance() {
<span class="nc bnc" id="L69" title="All 2 branches missed.">        if (instance == null) {</span>
<span class="nc" id="L70">            instance = new AppContext();</span>
        }
<span class="nc" id="L72">        return instance;</span>
    }

    public synchronized EntityManagerFactory getEntityManagerFactory(){
<span class="nc bnc" id="L76" title="All 2 branches missed.">        if (entityManagerFactory == null){</span>
<span class="nc" id="L77">            entityManagerFactory = Persistence.createEntityManagerFactory(PERSISTENCE);</span>
        }
<span class="nc" id="L79">        return entityManagerFactory;</span>
    }

    public synchronized EntityManager getEntityManager(){
<span class="nc bnc" id="L83" title="All 4 branches missed.">        if (entityManager == null  || !entityManager.isOpen()){</span>
<span class="nc" id="L84">            entityManager = getEntityManagerFactory().createEntityManager();</span>
        }
<span class="nc" id="L86">        return entityManager;</span>
    }

    public synchronized TransactionManager getTransactionManager() {
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (transactionManager == null){</span>
<span class="nc" id="L91">            transactionManager = new TransactionManager(getEntityManager());</span>
        }
<span class="nc" id="L93">        return transactionManager;</span>
    }

    public synchronized CargoDao getCargoDao(){
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if (cargoDao == null){</span>
<span class="nc" id="L98">            cargoDao = new CargoDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L100">        return cargoDao;</span>
    }

    public synchronized CargoStatusLogDao getCargoStatusLogDao() {
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (cargoStatusLogDao == null){</span>
<span class="nc" id="L105">            cargoStatusLogDao = new CargoStatusLogDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L107">        return cargoStatusLogDao;</span>
    }

    public synchronized CityDao getCityDao() {
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (cityDao == null){</span>
<span class="nc" id="L112">            cityDao = new CityDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L114">        return cityDao;</span>
    }

    public synchronized DriverDao getDriverDao() {
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (driverDao == null){</span>
<span class="nc" id="L119">            driverDao = new DriverDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L121">        return driverDao;</span>
    }

    public synchronized DriverStatisticDao getDriverStatisticDao() {
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (driverStatisticDao == null){</span>
<span class="nc" id="L126">            driverStatisticDao = new DriverStatisticDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L128">        return driverStatisticDao;</span>
    }

    public synchronized DriverStatusLogDao getDriverStatusLogDao() {
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (driverStatusLogDao == null){</span>
<span class="nc" id="L133">            driverStatusLogDao = new DriverStatusLogDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L135">        return driverStatusLogDao;</span>
    }

    public synchronized OrdersDao getOrdersDao() {
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (ordersDao == null){</span>
<span class="nc" id="L140">            ordersDao = new OrdersDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L142">        return ordersDao;</span>
    }

    public synchronized RoutePointDao getRoutePointDao() {
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if (routePointDao == null){</span>
<span class="nc" id="L147">            routePointDao = new RoutePointDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L149">        return routePointDao;</span>
    }

    public synchronized TruckDao getTruckDao() {
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (truckDao == null){</span>
<span class="nc" id="L154">            truckDao = new TruckDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L156">        return truckDao;</span>
    }

    public synchronized UserDao getUserDao() {
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (userDao == null){</span>
<span class="nc" id="L161">            userDao = new UserDaoImpl(getEntityManager());</span>
        }
<span class="nc" id="L163">        return userDao;</span>
    }

    public synchronized UserService getUserService() {
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (userService == null){</span>
<span class="nc" id="L168">            userService = new UserServiceImpl(getUserDao(), getTransactionManager());</span>
        }
<span class="nc" id="L170">        return userService;</span>
    }

    public synchronized DriverService getDriverService() {
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (driverService == null){</span>
<span class="nc" id="L175">            driverService = new DriverServiceImpl(getUserDao(),getDriverDao(),</span>
<span class="nc" id="L176">                    getDriverStatisticDao(), getTransactionManager());</span>
        }
<span class="nc" id="L178">        return driverService;</span>
    }

    public synchronized DutyService getDutyService() {
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (dutyService == null){</span>
<span class="nc" id="L183">            dutyService = new DutyServiceImpl(getDriverDao(), getDriverStatusLogDao(),</span>
<span class="nc" id="L184">                    getDriverStatisticDao(), getTransactionManager());</span>
        }
<span class="nc" id="L186">        return dutyService;</span>
    }

    public synchronized OrderAndCargoService getOrderAndCargoService() {
<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (orderAndCargoService == null){</span>
<span class="nc" id="L191">            orderAndCargoService = new OrderAndCargoServiceImpl(getOrdersDao(),</span>
<span class="nc" id="L192">                    getDriverDao(),getCargoDao(),</span>
<span class="nc" id="L193">                    getRoutePointDao(),getCityDao(),getTruckDao(),getDriverStatisticDao(),getTransactionManager());</span>
        }
<span class="nc" id="L195">        return orderAndCargoService;</span>
    }

    public synchronized OrderManagementService getOrderManagementService() {
<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (orderManagementService == null){</span>
<span class="nc" id="L200">            orderManagementService = new OrderManagementServiceImpl(getOrdersDao(),getDriverDao(),</span>
<span class="nc" id="L201">            getCargoDao(),getCargoStatusLogDao(),getTransactionManager());</span>
        }
<span class="nc" id="L203">        return orderManagementService;</span>
    }

    public synchronized TruckService getTruckService() {
<span class="nc bnc" id="L207" title="All 2 branches missed.">        if (truckService == null){</span>
<span class="nc" id="L208">            truckService = new TruckServiceImpl(getTruckDao(),getTransactionManager());</span>
        }
<span class="nc" id="L210">        return truckService;</span>
    }

    public synchronized DriverController getDriverController() {
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (driverController == null){</span>
<span class="nc" id="L215">            driverController = new DriverController(getDriverService(),getErrorProperties(),getValidator());</span>
        }
<span class="nc" id="L217">        return driverController;</span>
    }

    public synchronized OrderController getOrderController() {
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if (orderController == null){</span>
<span class="nc" id="L222">            orderController = new OrderController(getErrorProperties(),getOrderAndCargoService(),getTruckService(),getDriverService(),getValidator());</span>
        }
<span class="nc" id="L224">        return orderController;</span>
    }

    public synchronized TruckController getTruckController() {
<span class="nc bnc" id="L228" title="All 2 branches missed.">        if (truckController == null){</span>
<span class="nc" id="L229">            truckController = new TruckController(getErrorProperties(),getTruckService(),getValidator());</span>
        }
<span class="nc" id="L231">        return truckController;</span>
    }

    public synchronized LoginController getLoginController() {
<span class="nc bnc" id="L235" title="All 2 branches missed.">        if (loginController == null){</span>
<span class="nc" id="L236">            loginController = new LoginController(getErrorProperties(),getDriverService(),getUserService(),getValidator());</span>
        }
<span class="nc" id="L238">        return loginController;</span>
    }

    public synchronized DriverInfoController getDriverInfoController() {
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if (driverInfoController == null){</span>
<span class="nc" id="L243">            driverInfoController = new DriverInfoController(getErrorProperties(),getOrderAndCargoService());</span>
        }
<span class="nc" id="L245">        return driverInfoController;</span>
    }

    public synchronized ErrorController getErrorController() {
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (errorController == null){</span>
<span class="nc" id="L250">            errorController = new ErrorController(getErrorProperties());</span>
        }
<span class="nc" id="L252">        return errorController;</span>
    }

    public synchronized ControllerFactory getControllerFactory() {
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (controllerFactory == null){</span>
<span class="nc" id="L257">            controllerFactory = new ControllerFactory();</span>
        }
<span class="nc" id="L259">        return controllerFactory;</span>
    }

    public synchronized Validator getValidator() {
<span class="nc bnc" id="L263" title="All 2 branches missed.">        if (validator == null){</span>
<span class="nc" id="L264">            validator = new Validator();</span>
        }
<span class="nc" id="L266">        return validator;</span>
    }

    public synchronized Properties getErrorProperties() {
<span class="nc bnc" id="L270" title="All 2 branches missed.">        if (errorProperties == null){</span>
            try {
<span class="nc" id="L272">                errorProperties = new Properties();</span>
<span class="nc" id="L273">                InputStream in = getClass().getClassLoader().getResourceAsStream(&quot;error.properties&quot;);</span>
<span class="nc" id="L274">                errorProperties.load(in);</span>
<span class="nc" id="L275">                in.close();</span>
<span class="nc" id="L276">            } catch (IOException e) {</span>
<span class="nc" id="L277">                e.printStackTrace();</span>
<span class="nc" id="L278">            }</span>
        }
<span class="nc" id="L280">        return errorProperties;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>